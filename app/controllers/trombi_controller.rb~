class TrombiController < ApplicationController
	
	def index
		@people = Person.find(:all)	
	end
	
	def list
		@people = Person.find(:all)
	end
	
	def show_details
		@person = Person.find(params[:id])
	end
	
	def search
		@query = params[:search]
		@people = Person.search(params[:search])
	end
	
	def account
	@user = User.find(session[:user_id])
	if request.post?
		respond_to do |format|
			if @user.update_attributes(params[:user])
				flash[:notice] = "User #{@user.name} was succesfully updated."
				format.html { redirect_to(:controller=>"trombi", :action=>"account") }
				format.xml  { head :ok }
			else
				format.html { render :controller=>"trombi", :action => "account" }
				format.xml  { render :xml => @user.errors, :status => :unprocessable_entity }
			end
			
		end
	end
	end
	
	def login
	session[:user_id]=nil
	session[:user_level]=nil
	
		  if request.post?
			  user = User.authenticate(params[:name], params[:password])
			  if user
				  session[:user_id]=user.id
				  session[:user_level]=user.level
				  redirect_to(:controller => "trombi", :action=>"index")
			  else
				  flash.now[:notice] = "Invalid user/password combination"
			  end
		  end
	end

	
	def logout
		session[:user_id]=nil
		session[:user_level]=nil
		redirect_to(:action => "index")
  	end
end
